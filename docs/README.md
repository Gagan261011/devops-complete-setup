# DevOps Complete Setup – One-Click AWS Lab

This repo boots a full CI/CD lab on AWS with a single `terraform apply`, then runs a Jenkins pipeline that builds, scans, publishes, deploys, and smoke-tests a sample Spring Boot CRUD app. All servers are Ubuntu 22.04 on `t3.medium`.

## Stack
- Jenkins (JCasC + Job DSL) with preseeded admin/plugins/credentials and a `java-crud-ci-cd` pipeline pointing to this repo.
- SonarQube (admin password reset to `Admin123!`) configured for Jenkins usage.
- Nexus 3 with admin password set to `Admin123!` and hosted repo `${var.nexus_repo_name}` (default `maven-releases`).
- Ansible master (with generated SSH key) + Ansible slave.
- Application server target.

## Prerequisites
- Terraform >= 1.5 and AWS credentials exported (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_DEFAULT_REGION`).
- Existing AWS key pair name for break-glass SSH (`var.key_pair_name`).
- Set `var.repo_url` to a reachable Git URL for this repo (public or private with your own auth).
- Optional: adjust `allowed_ssh_cidr` to your IP.

## Quickstart
```bash
git clone <this-repo-url>
cd devops-complete-setup/terraform
cat > terraform.tfvars <<EOF
aws_region       = "us-east-1"
availability_zone = "us-east-1a"
key_pair_name    = "<your-keypair>"
repo_url         = "<git-url-to-this-repo>"
allowed_ssh_cidr = "<your-ip>/32"
EOF

terraform init
terraform apply
```

Terraform writes `../ansible/inventory.ini` with private IPs and prints useful outputs (Jenkins/Sonar/Nexus/App URLs). All user-data is injected automatically.

## After apply
1) Open Jenkins: output `jenkins_url` (admin / `Admin123!`).
2) You should see job `java-crud-ci-cd` already created; run it. Stages: checkout → build → Sonar → upload to Nexus → deploy via Ansible → smoke test.
3) App health: `http://<app_server_ip>:8080/health`.

## Service creds (lab defaults)
- Jenkins: `admin` / `Admin123!`
- SonarQube: `admin` / `Admin123!`
- Nexus: `admin` / `Admin123!`
- Ansible SSH key: generated by Terraform; stored on Jenkins at `/var/lib/jenkins/.ssh/ansible` and distributed to Ansible master/slave/app via cloud-init.

## Notes
- Ports opened: 22 (from `allowed_ssh_cidr`), 8080 (Jenkins + app), 9000 (SonarQube), 8081 (Nexus), 80 (app).
- All inter-service communication uses private IPs inside the VPC.
- Destroy with `terraform destroy` from the `terraform/` directory when finished.
